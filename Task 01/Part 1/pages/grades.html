<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
</head>
<body style="background-color: #f8f9fa; font-family: Tahoma, sans-serif;">

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: #0d6efd;">ğŸ“„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h2>
        <a href="../index.html" class="btn btn-secondary">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ / ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø±Ø¬Ø© -->
    <div class="card shadow p-4 mb-4">
        <h5 class="mb-3">Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø© Ø·Ø§Ù„Ø¨</h5>
        <form onsubmit="saveGrade(event)">
            <input type="hidden" id="editIndex">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨:</label>
                    <input type="text" id="studentIdInput" class="form-control" oninput="loadStudentName()" required>
                    <div id="studentNameDisplay" class="info-text"></div>
                </div>
                <div class="col-md-4">
                    <label>Ø§Ù„Ù…Ù‚Ø±Ø±:</label>
                    <select id="courseSelect" class="form-control" required>
                        <option disabled selected>-- Ø§Ø®ØªØ± Ù…Ù‚Ø±Ø± --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>Ø§Ù„Ø¯Ø±Ø¬Ø©:</label>
                    <input type="number" id="gradeInput" class="form-control" min="0" max="100" required>
                </div>
            </div>
            <button class="btn btn-success">âœ”ï¸ Ø­ÙØ¸</button>
        </form>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª -->
    <input type="text" class="form-control mb-3" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ù…Ù‚Ø±Ø±..." onkeyup="searchGrades(this.value)">
    <table class="table table-bordered text-center bg-white shadow" id="gradesTable">
        <thead class="table-light">
            <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
        </thead>
        <tbody id="gradesBody"></tbody>
    </table>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
    const students = [
        { name: "Ø£Ø­Ù…Ø¯ ", id: "2023001", courses: ["CS101", "CS102"] },
        { name: "Ù…Ø­Ù…Ø¯", id: "2023002", courses: ["CS101", "CS103"] },
    ];

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª
    const courses = {
        "CS101": "Ø¨Ø±Ù…Ø¬Ø© Ù…ØªÙ‚Ø¯Ù…Ø©",
        "CS102": "Ù‡ÙŠØ§ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª",
        "CS103": "Ù†Ø¸Ù… ØªØ´ØºÙŠÙ„",
        "CS104": "Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø­Ø§Ø³ÙˆØ¨"
    };

    // Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
    let grades = [];

    window.onload = updateGradesTable;

    function loadStudentName() {
        const inputId = document.getElementById("studentIdInput").value.trim();
        const nameDisplay = document.getElementById("studentNameDisplay");
        const courseSelect = document.getElementById("courseSelect");
        courseSelect.innerHTML = '<option disabled selected>-- Ø§Ø®ØªØ± Ù…Ù‚Ø±Ø± --</option>';

        const student = students.find(s => s.id === inputId);
        if (student) {
            nameDisplay.innerText = student.name;
            // ØªØ­Ù…ÙŠÙ„ Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            student.courses.forEach(code => {
                const option = document.createElement("option");
                option.value = code;
                option.text = `${courses[code]} - ${code}`;
                courseSelect.appendChild(option);
            });
        } else {
            nameDisplay.innerText = "ğŸš« Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
        }
    }

    function saveGrade(event) {
        event.preventDefault();
        const studentId = document.getElementById("studentIdInput").value.trim();
        const courseCode = document.getElementById("courseSelect").value;
        const grade = parseFloat(document.getElementById("gradeInput").value);
        const editIndex = document.getElementById("editIndex").value;

        const student = students.find(s => s.id === studentId);
        if (!student) {
            alert("ğŸš« Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­");
            return;
        }

        const courseName = courses[courseCode];

        if (editIndex === "") {
            const exists = grades.some(g => g.studentId === studentId && g.courseCode === courseCode);
            if (exists) {
                alert("âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø±Ø¬Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø±Ø± Ù…Ø³Ø¨Ù‚Ù‹Ø§");
                return;
            }

            grades.push({
                studentName: student.name,
                studentId: student.id,
                courseName: courseName,
                courseCode: courseCode,
                grade: grade
            });
        } else {
            grades[editIndex] = {
                studentName: student.name,
                studentId: student.id,
                courseName: courseName,
                courseCode: courseCode,
                grade: grade
            };
        }

        document.querySelector("form").reset();
        document.getElementById("studentNameDisplay").innerText = "";
        document.getElementById("courseSelect").innerHTML = '<option disabled selected>-- Ø§Ø®ØªØ± Ù…Ù‚Ø±Ø± --</option>';
        document.getElementById("editIndex").value = "";
        updateGradesTable();
    }

    function updateGradesTable() {
        const body = document.getElementById("gradesBody");
        body.innerHTML = "";

        grades.forEach((g, i) => {
            const row = body.insertRow();
            row.innerHTML = `
                <td>${g.studentName}</td>
                <td>${g.studentId}</td>
                <td>${g.courseName}</td>
                <td>${g.courseCode}</td>
                <td>${g.grade}</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick="editGrade(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteGrade(${i})">Ø­Ø°Ù</button>
                </td>
            `;
        });
    }

    function editGrade(index) {
        const g = grades[index];
        document.getElementById("studentIdInput").value = g.studentId;
        loadStudentName();
        setTimeout(() => {
            document.getElementById("courseSelect").value = g.courseCode;
        }, 100); // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª
        document.getElementById("gradeInput").value = g.grade;
        document.getElementById("editIndex").value = index;
    }

    function deleteGrade(index) {
        grades.splice(index, 1);
        updateGradesTable();
    }

    function searchGrades(value) {
        const rows = document.querySelectorAll("#gradesTable tbody tr");
        rows.forEach(row => {
            row.style.display = row.innerText.includes(value) ? "" : "none";
        });
    }
</script>

</body>
</html>
